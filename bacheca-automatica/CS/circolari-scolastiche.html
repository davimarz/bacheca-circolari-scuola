<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Circolari Scolastiche</title>
    <style>
        :root {
            --primary-pastel: #b5e0ff;
            --secondary-pastel: #ffd6e0;
            --accent-pastel: #c9ffc9;
            --background-pastel: #fff9fb;
            --text-color: #333;
            --border-pastel: #e0c8ff;
            --shadow-light: rgba(181, 224, 255, 0.3);
            --card-pastel: #ffffff;
            --input-pastel: #f8f9ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-pastel);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-bottom: 3px solid var(--primary-pastel);
        }

        .header h1 {
            color: #6b7b8c;
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .header h2 {
            color: #8b9baa;
            font-weight: normal;
            font-size: 1.4rem;
        }

        .update-info {
            background-color: var(--accent-pastel);
            padding: 15px;
            border-radius: 12px;
            margin: 20px auto;
            max-width: 800px;
            text-align: center;
            box-shadow: 0 4px 8px var(--shadow-light);
            font-size: 1.1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            color: #5a6c5a;
        }

        .year-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            background-color: var(--input-pastel);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--border-pastel);
            margin: 20px auto 30px;
            max-width: 800px;
            box-shadow: 0 4px 8px var(--shadow-light);
        }

        .year-selector label {
            font-weight: 600;
            color: #6b7b8c;
        }

        .year-selector select {
            padding: 10px 15px;
            border-radius: 6px;
            border: 2px solid var(--primary-pastel);
            background-color: white;
            font-size: 1rem;
            color: #2c3e50;
            cursor: pointer;
            min-width: 150px;
        }

        .controls-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            background-color: var(--card-pastel);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow-light);
        }

        .search-section {
            display: flex;
            flex: 1;
            min-width: 400px;
            gap: 12px;
            align-items: center;
        }

        .search-input {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid var(--primary-pastel);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: var(--input-pastel);
            color: #333;
        }

        .search-input:focus {
            outline: none;
            border-color: #8ac7e0;
            box-shadow: 0 0 0 3px rgba(138, 199, 224, 0.2);
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-pastel);
            color: #2c3e50;
        }

        .btn-primary:hover {
            background-color: #9bd1e9;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--secondary-pastel);
            color: #2c3e50;
        }

        .btn-secondary:hover {
            background-color: #ffb8c9;
            transform: translateY(-2px);
        }

        .circolari-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .circolare-card {
            background-color: var(--card-pastel);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 15px var(--shadow-light);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border-pastel);
        }

        .circolare-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(181, 224, 255, 0.4);
        }

        .circolare-header {
            background-color: var(--primary-pastel);
            padding: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .circolare-numero {
            font-weight: bold;
            font-size: 1.3rem;
            color: #2c3e50;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 5px 12px;
            border-radius: 20px;
        }

        .circolare-data {
            color: #5a6c7d;
            font-size: 0.9rem;
        }

        .circolare-content {
            padding: 20px;
        }

        .circolare-title {
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 1.2rem;
            color: #2c3e50;
            line-height: 1.4;
        }

        .circolare-body {
            color: #555;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .circolare-link {
            display: inline-block;
            background-color: var(--accent-pastel);
            color: #2c3e50;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .circolare-link:hover {
            background-color: #a8e0a8;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .badge-new {
            background-color: var(--secondary-pastel);
            color: #b34a4a;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid var(--border-pastel);
            color: #8b9baa;
            font-size: 0.9rem;
        }

        .hidden {
            display: none !important;
        }

        .database-message {
            display: none;
        }

        @media (max-width: 768px) {
            .controls-container {
                flex-direction: column;
                align-items: stretch;
            }

            .search-section {
                min-width: 100%;
                flex-direction: column;
                align-items: stretch;
            }

            .search-section input, 
            .search-section button {
                width: 100%;
            }

            .circolari-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìö Circolari Scolastiche</h1>
        <h2>Istituto di Istruzione Superiore "G. Marconi" - Agrigento</h2>
    </div>

    <div class="update-info">
        <span>üîÑ Prossimo aggiornamento automatico tra: 30 minuti</span>
    </div>

    <div class="year-selector">
        <label for="anno-scolastico">Anno Scolastico:</label>
        <select id="anno-scolastico">
            <option value="2025-2026" selected>2025/2026</option>
            <option value="2024-2025">2024/2025</option>
            <option value="2023-2024">2023/2024</option>
            <option value="2022-2023">2022/2023</option>
        </select>
    </div>

    <div class="controls-container">
        <div class="search-section">
            <input type="text" class="search-input" id="search-input" placeholder="Cerca per numero o testo...">
            <button class="btn btn-primary" id="search-btn">üîç Cerca</button>
            <button class="btn btn-secondary" id="clear-btn">‚ùå Cancella</button>
        </div>
    </div>

    <div id="circolari-list" class="circolari-container">
        <!-- Le circolari verranno caricate qui dinamicamente -->
    </div>

    <div class="footer">
        <p>Babisca Grisdini | C.Azzo Fumi - Agrigento</p>
        <p>Sistema di gestione circolari scolastiche - Versione 2.0</p>
    </div>

    <!-- Messaggio nascosto per evitare il problema dello screen 33 -->
    <div class="database-message hidden">
        üìä Colonne trovate nel database: id, titolo, contenuto, data_pubblicazione, pdf_url, created_at, updated_at
    </div>

    <script>
        // Database delle circolari (simulato - in un'app reale verrebbe da un server)
        const circolariDatabase = [
            {
                id: 1,
                numero: "151",
                titolo: "Disposizioni di servizio in vista della sospensione delle attivit√† educative e didattiche in occasione delle vacanze natalizie",
                contenuto: "Circolare relativa alle disposizioni di servizio per la sospensione delle attivit√† educative e didattiche in occasione delle vacanze natalizie per l'anno scolastico 2025/26.",
                data_pubblicazione: "10/01/2026",
                pdf_url: "https://www.circolare.org/circolare-151.pdf",
                anno_scolastico: "2025-2026"
            },
            {
                id: 2,
                numero: "150",
                titolo: "Pubblicazione del Vademecum del Garante 'La scuola a prova di privacy 2025' e adeguamento delle prassi interne in materia di protezione dei dati personali",
                contenuto: "Circolare riguardante la pubblicazione del Vademecum del Garante per la privacy e l'adeguamento delle prassi interne in materia di protezione dei dati personali.",
                data_pubblicazione: "10/01/2026",
                pdf_url: "https://www.circolare.org/circolare-150.pdf",
                anno_scolastico: "2025-2026"
            },
            {
                id: 3,
                numero: "149",
                titolo: "Richiesta partecipazione Concorso Nazionale di scrittura 'Giulthriamacci '26'",
                contenuto: "Circolare per la richiesta di partecipazione al Concorso Nazionale di scrittura 'Giulthriamacci '26'. Scadenza per l'adesione: 30 gennaio 2026.",
                data_pubblicazione: "08/01/2026",
                pdf_url: "https://www.circolare.org/circolare-149.pdf",
                anno_scolastico: "2025-2026",
                nuova: true
            },
            {
                id: 4,
                numero: "148",
                titolo: "Orario delle lezioni per il secondo quadrimestre",
                contenuto: "Comunicazione del nuovo orario delle lezioni valido dal 1 febbraio 2026. Si prega di prendere visione delle modifiche apportate.",
                data_pubblicazione: "05/01/2026",
                pdf_url: "https://www.circolare.org/circolare-148.pdf",
                anno_scolastico: "2025-2026"
            },
            {
                id: 5,
                numero: "147",
                titolo: "Corso di formazione sulla sicurezza per il personale docente",
                contenuto: "Organizzazione di un corso di formazione obbligatorio sulla sicurezza nei luoghi di lavoro per tutto il personale docente. Le iscrizioni sono aperte fino al 15 gennaio.",
                data_pubblicazione: "03/01/2026",
                pdf_url: "https://www.circolare.org/circolare-147.pdf",
                anno_scolastico: "2025-2026"
            },
            {
                id: 6,
                numero: "146",
                titolo: "Rinnovo biblioteca scolastica - Acquisto nuovi volumi",
                contenuto: "Comunicazione relativa al rinnovo del patrimonio librario della biblioteca scolastica. Invito a proporre titoli per nuovi acquisti entro il 20 gennaio 2026.",
                data_pubblicazione: "20/12/2025",
                pdf_url: "https://www.circolare.org/circolare-146.pdf",
                anno_scolastico: "2025-2026"
            }
        ];

        // Elementi DOM
        const circolariList = document.getElementById('circolari-list');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const clearBtn = document.getElementById('clear-btn');
        const annoScolasticoSelect = document.getElementById('anno-scolastico');

        // Funzione per formattare la data
        function formatDate(dateString) {
            if (!dateString) return '';
            return dateString;
        }

        // Funzione per creare una card della circolare
        function createCircolareCard(circolare) {
            const card = document.createElement('div');
            card.className = 'circolare-card';
            
            const dataFormattata = formatDate(circolare.data_pubblicazione);
            
            card.innerHTML = `
                <div class="circolare-header">
                    <div class="circolare-numero">N.${circolare.numero}</div>
                    <div class="circolare-data">Pubblicata ${dataFormattata}</div>
                </div>
                <div class="circolare-content">
                    <div class="circolare-title">
                        ${circolare.titolo}
                        ${circolare.nuiva ? '<span class="badge badge-new">NUOVA</span>' : ''}
                    </div>
                    <div class="circolare-body">${circolare.contenuto}</div>
                    <a href="${circolare.pdf_url}" target="_blank" class="circolare-link">Visualizza PDF</a>
                </div>
            `;
            
            return card;
        }

        // Funzione per visualizzare le circolari
        function displayCircolari(circolari = circolariDatabase) {
            circolariList.innerHTML = '';
            
            const annoSelezionato = annoScolasticoSelect.value;
            const termineRicerca = searchInput.value.toLowerCase();
            
            // Filtra le circolari in base all'anno scolastico e al termine di ricerca
            const circolariFiltrate = circolari.filter(circolare => {
                // Filtro per anno scolastico
                const corrispondeAnno = circolare.anno_scolastico === annoSelezionato;
                
                // Filtro per ricerca
                const corrispondeRicerca = termineRicerca === '' || 
                    circolare.numero.toLowerCase().includes(termineRicerca) ||
                    circolare.titolo.toLowerCase().includes(termineRicerca) ||
                    circolare.contenuto.toLowerCase().includes(termineRicerca);
                
                return corrispondeAnno && corrispondeRicerca;
            });
            
            // Se non ci sono risultati
            if (circolariFiltrate.length === 0) {
                const noResults = document.createElement('div');
                noResults.className = 'no-results';
                noResults.style.textAlign = 'center';
                noResults.style.padding = '40px';
                noResults.style.color = '#8b9baa';
                noResults.innerHTML = `
                    <h3>Nessuna circolare trovata</h3>
                    <p>Prova a modificare i criteri di ricerca o selezionare un altro anno scolastico</p>
                `;
                circolariList.appendChild(noResults);
                return;
            }
            
            // Ordina le circolari per numero (decrescente)
            circolariFiltrate.sort((a, b) => parseInt(b.numero) - parseInt(a.numero));
            
            // Crea le card per ogni circolare
            circolariFiltrate.forEach(circolare => {
                const card = createCircolareCard(circolare);
                circolariList.appendChild(card);
            });
        }

        // Funzione per scaricare tutte le circolari
        function downloadAllCircolari() {
            const annoSelezionato = annoScolasticoSelect.value;
            const circolariAnno = circolariDatabase.filter(c => c.anno_scolastico === annoSelezionato);
            
            if (circolariAnno.length === 0) {
                alert(`Nessuna circolare disponibile per l'anno scolastico ${annoSelezionato.replace('-', '/')}`);
                return;
            }
            
            // Crea un oggetto con le circolari
            const datiDownload = {
                anno_scolastico: annoSelezionato,
                data_esportazione: new Date().toLocaleString('it-IT'),
                numero_circolari: circolariAnno.length,
                circolari: circolariAnno
            };
            
            // Converti in JSON
            const jsonData = JSON.stringify(datiDownload, null, 2);
            
            // Crea un blob e un link per il download
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `circolari_${annoSelezionato}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert(`Scaricati ${circolariAnno.length} circolari per l'anno scolastico ${annoSelezionato.replace('-', '/')}`);
        }

        // Inizializzazione
        function init() {
            // Visualizza le circolari iniziali
            displayCircolari();
            
            // Aggiungi event listener per la ricerca
            searchBtn.addEventListener('click', () => {
                displayCircolari();
            });
            
            // Ricerca mentre si digita (con debounce)
            let searchTimeout;
            searchInput.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    displayCircolari();
                }, 300);
            });
            
            // Pulsante cancella ricerca
            clearBtn.addEventListener('click', () => {
                searchInput.value = '';
                displayCircolari();
                searchInput.focus();
            });
            
            // Cambio anno scolastico
            annoScolasticoSelect.addEventListener('change', () => {
                displayCircolari();
            });
            
            // Aggiungi pulsante per il download (aggiunto al container dei controlli)
            const downloadBtn = document.createElement('button');
            downloadBtn.className = 'btn btn-primary';
            downloadBtn.id = 'download-btn';
            downloadBtn.innerHTML = 'üì• Scarica tutte le circolari';
            downloadBtn.addEventListener('click', downloadAllCircolari);
            
            // Aggiungi il pulsante al container dei controlli
            const controlsContainer = document.querySelector('.controls-container');
            controlsContainer.appendChild(downloadBtn);
            
            // Focus sul campo di ricerca all'inizio
            searchInput.focus();
        }

        // Avvia l'applicazione quando il DOM √® caricato
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
